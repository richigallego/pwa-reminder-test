<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reminder PWA</title>
    <meta name="theme-color" content="#4CAF50">
    <link rel="manifest" href="data:application/json;base64,ewogICJuYW1lIjogIlJlbWluZGVyIFBXQSIsCiAgInNob3J0X25hbWUiOiAiUmVtaW5kZXIiLAogICJzdGFydF91cmwiOiAiLyIsCiAgImRpc3BsYXkiOiAic3RhbmRhbG9uZSIsCiAgImJhY2tncm91bmRfY29sb3IiOiAiIzRDQUY1MCIsCiAgInRoZW1lX2NvbG9yIjogIiM0Q0FGNTAiLAogICJpY29ucyI6IFsKICAgIHsKICAgICAgInNyYyI6ICJodHRwczovL2Vtb2ppcy5zbGFja21vamlzLmNvbS9lbW9qaXMvYWxhcm0tY2xvY2svYXBwbGUvYWxhcm0tY2xvY2suanBnIiwKICAgICAgInNpemVzIjogIjE5MngxOTIiLAogICAgICAidHlwZSI6ICJpbWFnZS9wbmciCiAgICB9CiAgXQp9">
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }

        .container {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        h1 {
            color: #4CAF50;
            text-align: center;
        }

        .form-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            color: #666;
        }

        input, textarea {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }

        button {
            background: #4CAF50;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            width: 100%;
            font-size: 16px;
        }

        button:hover {
            background: #45a049;
        }

        #reminders {
            margin-top: 20px;
        }

        .reminder-item {
            background: #f8f8f8;
            padding: 10px;
            margin-bottom: 10px;
            border-radius: 4px;
            border-left: 4px solid #4CAF50;
        }

        .delete-btn {
            background: #ff4444;
            padding: 5px 10px;
            margin-left: 10px;
            float: right;
        }

        .delete-btn:hover {
            background: #cc0000;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üìÖ Recordatorios</h1>
        
        <div class="form-group">
            <label for="reminderText">Recordatorio:</label>
            <textarea id="reminderText" rows="2" placeholder="¬øQu√© necesitas recordar?"></textarea>
        </div>
        
        <div class="form-group">
            <label for="reminderTime">¬øCu√°ndo?</label>
            <input type="datetime-local" id="reminderTime">
        </div>
        
        <button onclick="addReminder()">Crear Recordatorio</button>
        
        <div id="reminders"></div>
    </div>

    <script>
        // Registrar Service Worker
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('/sw.js')
                .then(registration => {
                    console.log('Service Worker registrado');
                    requestNotificationPermission();
                })
                .catch(err => console.error('Error al registrar Service Worker:', err));
        }

        // Solicitar permiso para notificaciones
        async function requestNotificationPermission() {
            try {
                const permission = await Notification.requestPermission();
                if (permission === 'granted') {
                    console.log('Permiso de notificaciones concedido');
                }
            } catch (err) {
                console.error('Error al solicitar permiso:', err);
            }
        }

        // Cargar recordatorios guardados
        let reminders = JSON.parse(localStorage.getItem('reminders') || '[]');
        updateRemindersDisplay();

        function addReminder() {
            const text = document.getElementById('reminderText').value;
            const time = document.getElementById('reminderTime').value;
            
            if (!text || !time) {
                alert('Por favor completa todos los campos');
                return;
            }

            const reminder = {
                id: Date.now(),
                text,
                time,
            };

            reminders.push(reminder);
            localStorage.setItem('reminders', JSON.stringify(reminders));
            
            scheduleNotification(reminder);
            updateRemindersDisplay();
            
            // Limpiar formulario
            document.getElementById('reminderText').value = '';
            document.getElementById('reminderTime').value = '';
        }

        function deleteReminder(id) {
            reminders = reminders.filter(r => r.id !== id);
            localStorage.setItem('reminders', JSON.stringify(reminders));
            updateRemindersDisplay();
        }

        function updateRemindersDisplay() {
            const container = document.getElementById('reminders');
            container.innerHTML = '';
            
            reminders.sort((a, b) => new Date(a.time) - new Date(b.time))
                    .forEach(reminder => {
                const div = document.createElement('div');
                div.className = 'reminder-item';
                const formattedDate = new Date(reminder.time).toLocaleString();
                div.innerHTML = `
                    <strong>${reminder.text}</strong><br>
                    ${formattedDate}
                    <button onclick="deleteReminder(${reminder.id})" class="delete-btn">üóëÔ∏è</button>
                `;
                container.appendChild(div);
            });
        }

        function scheduleNotification(reminder) {
            const now = new Date().getTime();
            const reminderTime = new Date(reminder.time).getTime();
            
            if (reminderTime > now) {
                const delay = reminderTime - now;
                setTimeout(() => {
                    if (Notification.permission === 'granted') {
                        new Notification('Recordatorio', {
                            body: reminder.text,
                            icon: '/icon.png'
                        });
                    }
                }, delay);
            }
        }

        // Programar notificaciones para recordatorios existentes
        reminders.forEach(scheduleNotification);
    </script>

    <script>
        // Service Worker inline para Netlify
        self.addEventListener('install', event => {
            self.skipWaiting();
        });

        self.addEventListener('activate', event => {
            return self.clients.claim();
        });

        self.addEventListener('push', event => {
            const options = {
                body: event.data.text(),
                icon: '/icon.png',
                badge: '/badge.png'
            };

            event.waitUntil(
                self.registration.showNotification('Recordatorio', options)
            );
        });
    </script>
</body>
</html>